id:          RESERVOIR_SAMPLING
name:        RESERVOIR SAMPLING

version:     1.3.7.8

description: |
  <p>This module implements <b>reservoir sampling</b> â€” a technique used to keep a uniformly random sample from a stream of values,
  even when the total number of items is unknown or extremely large.</p>

  <p><b>What It Does:</b></p>

  <p><b>1. Stores a fixed-size random sample</b></p>
  <p>You can add any number of values to a reservoir sampling object using <b>RSADD</b>.
  Even if millions of items are added, the module keeps only <b>rs_count</b> items,
  but ensures that every item from the stream has an equal chance to appear in the reservoir.</p>

  <p><b>2. Supports fixed-size values</b></p>
  <p>Each item stored in the reservoir has a predefined size (<b>rs_value_size</b>).
  This keeps the structure compact and guarantees stable memory usage.</p>

  <table border="1" class="x">
    <tr><th>Value</th><th>Size</th><th>Comment</th></tr>
    <tr><td align="right"> 16</td><td align="right"> 15</td><td>IP4</td></tr>
    <tr><td align="right"> 32</td><td align="right"> 31</td><td>&nbsp;</td></tr>
    <tr><td align="right"> 40</td><td align="right"> 39</td><td>IP6</td></tr>
    <tr><td align="right"> 64</td><td align="right"> 64</td><td></td></tr>
    <tr><td align="right">128</td><td align="right">127</td><td></td></tr>
    <tr><td align="right">256</td><td align="right">255</td><td>Pascal string</td></tr>
  </table>

  <p><b>3. Randomized insertion logic</b></p>
  <p>When adding items, some values will replace existing samples while others will be skipped. <b>RSADD</b> returns:</p>
  <ul>
    <li><b>1</b> - if at least one of the provided items was included in the reservoir</li>
    <li><b>0</b> - if none of the items were selected</li>
  </ul>

  <p><b>4. Retrieving the sample</b></p>
  <p>You can retrieve the current sample set using <b>RSGET</b>. The returned array contains up to <b>rs_count</b> items.</p>

  <p><b>5. Tracking total insertions</b></p>
  <p><b>RSGETCOUNT</b> tells you how many total items were attempted for insertion into the reservoir, even if they were not selected.</p>
  <p><b>Use Cases:</b></p>
  <ul>
    <li>Uniform random sampling of high-volume data streams</li>
    <li>Analytics pipelines</li> <li>Approximation algorithms</li>
    <li>Monitoring and logging systems</li>
  </ul>

  <p><b>Tip:</b> The reservoir sampling object is deterministic given identical sequences of inserts, making it useful for reproducible sampling scenarios.</p>

example_module:     |
  127.0.0.1:6379> del myrs
  (integer) 1
  127.0.0.1:6379> rsadd myrs 5 64 google yahoo cloudflare outlook facebook amazon
  (integer) 1
  127.0.0.1:6379> rsadd myrs 5 64 oracle hotmail softlayer
  (integer) 1
  127.0.0.1:6379> rsadd myrs 5 64 wikipedia
  (integer) 0
  127.0.0.1:6379> rsget myrs 5 64
  1) "google"
  2) "oracle"
  3) "cloudflare"
  4) "outlook"
  5) "facebook"
  127.0.0.1:6379> rsgetcount myrs 5 64
  (integer) 9

