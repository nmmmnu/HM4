id:          MORTONCURVE2D
name:        MORTON CURVE 2D

version:     1.3.7.7

description: |

  <p>This module includes an efficient multidimensional indexing module based on the <b>Morton curve</b> (also known as <b>Z-order curve</b>).
  This structure allows you to store and query points in 2D by mapping them into a single sortable integer using bit interleaving.</p>
  <p>Coordinates are uint32_t, indexes type are uint64_t</p>
  <p>The result is a fast, disk-friendly spatial index suitable for filtering and range searches.</p>
  <p><b>General Concept</b></p>
  <ul>
    <li>You insert a point with some coordinates.</li>
    <li>The module computes the Morton key by interleaving bits.</li>
    <li>All points are stored in sorted order by their Morton code.</li>
    <li>Queries operate by converting coordinates or ranges into corresponding Morton code intervals</li>
  </ul>
  <p>All MC commands share the same pattern:
  MC{n}{op}<br />
  Where:</p>
  <ul>
    <li><b>n</b> = number of dimensions (2, 3, 4, 8, 16)</li>
    <li><b>op</b> = operation: <b>ADD</b>, <b>POINT</b>, <b>RANGE</b>, etc.</li>
  </ul>
  <p><b>Notes</b></p>
  <ul>
    <li>Morton curves preserve spatial locality well, making disk-based range lookups efficient.</li>
    <li>POINT = optimized mode when all dimensions are exact values.</li>
    <li>RANGE = full multidimensional "rectangle".</li>
    <li>Coordinates are uint32_t</li>
    <li>Lndexes type are uint64_t</li>
  </ul>

  <p>Suppose we have a company with two offices in:</p>
  <ul>
    <li>LA  = 1</li>
    <li>NYC = 2</li>
  </ul>

  <p>Each office have two kind of employees:</p>
  <ul>
    <li>sales   = 1</li>
    <li>support = 2</li>
  </ul>

  <pre class="x">
  mc2add users 0 1 1 john   <- adds user_id 0, john,   sales,   LA
  mc2add users 1 1 1 peter  <- adds user_id 1, peter,  sales,   LA
  mc2add users 2 2 1 jill   <- adds user_id 2, jill,   support, LA
  mc2add users 3 1 2 robert <- adds user_id 3, robert, sales,   NYC
  mc2add users 4 2 2 pola   <- adds user_id 4, pola,   support, NYC
  mc2add users 5 2 2 pepe   <- adds user_id 5, pepe,   support, NYC
  mc2point users 2 2 10000  <- gets all support from LA (pola, pepe)
  </pre>

example:     |
  127.0.0.1:6379> MC2ADD users 0 1 1 john
  Error: Broken pipe
  127.0.0.1:6379> MC2ADD users 0 1 1 john
  OK
  127.0.0.1:6379> MC2ADD users 1 1 1 peter
  OK
  127.0.0.1:6379> MC2ADD users 2 2 1 jill
  OK
  127.0.0.1:6379> MC2ADD users 3 1 2 robert
  OK
  127.0.0.1:6379> MC2ADD users 4 2 2 pola
  OK
  127.0.0.1:6379> MC2ADD users 5 2 2 pepe
  OK
  127.0.0.1:6379> MC2POINT users 2 2 10000
  1) "0000000002,0000000002,00000000"
  2) "pola"
  3) "0000000002,0000000002,00000001"
  4) "pepe"
  5) ""
  127.0.0.1:6379> MC2RANGE users 2 2 2 2 10000
  1) "0000000002,0000000002,00000000"
  2) "pola"
  3) "0000000002,0000000002,00000001"
  4) "pepe"
  5) ""
  127.0.0.1:6379> MC2RANGE users 2 2 1 2 10000
  1) "0000000002,0000000001,00000000"
  2) "jill"
  3) "0000000002,0000000002,00000001"
  4) "pola"
  5) "0000000002,0000000002,00000002"
  6) "pepe"
  7) ""
  127.0.0.1:6379> MC2RANGE users 1 2 2 2 10000
  1) "0000000001,0000000002,00000000"
  2) "robert"
  3) "0000000002,0000000002,00000001"
  4) "pola"
  5) "0000000002,0000000002,00000002"
  6) "pepe"
  7) ""
  127.0.0.1:6379> MC2RANGE users 1 2 1 2 10000
   1) "0000000001,0000000001,00000000"
   2) "john"
   3) "0000000001,0000000001,00000001"
   4) "peter"
   5) "0000000002,0000000001,00000002"
   6) "jill"
   7) "0000000001,0000000002,00000003"
   8) "robert"
   9) "0000000002,0000000002,00000004"
  10) "pola"
  11) "0000000002,0000000002,00000005"
  12) "pepe"
  13) ""


see_also_module:
  items:
    - linearcurve
    - mortoncurve3d
    - mortoncurve4d
    - mortoncurve8d
    - mortoncurve16d

